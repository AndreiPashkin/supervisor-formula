machine:
  python:
    version: 2.7
  pre:
    - cat /etc/issue
    - sudo apt-get update
    - sudo apt-get install -t trusty-backports -y lxd lxd-client
    - lxc remote add images images.linuxcontainers.org || true
  environment:
    SNAPSHOT: snapshot
    SHARE: /tmp/share

dependencies:
  pre:
    - pip install tox==2.3.1

test:
  pre:
    - git clone . $(SHARE)
  override:
    - lxc launch images:ubuntu/trusty/amd64 trusty64
    - sudo chown -R $(sudo ls -l /var/lib/lxd/containers | grep trusty64 | cut -f3 -d ' ') $(SHARE)
    - SNAPSHOT=snapshot CONTAINER=trusty64 make snapshot
    - tox -v -e main:
        timeout: 99999
